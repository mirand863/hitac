#!/usr/bin/env python3
"""Script to predict with hierarchical classifier."""
import argparse
import pickle
import sys
from argparse import Namespace

from hitac._utils import load_reference, fit


def parse_args(args: list) -> Namespace:
    """
    Parse a list of arguments.

    Parameters
    ----------
    args : list
        Arguments to parse.

    Returns
    -------
    _ : Namespace
        Parsed arguments.
    """
    parser = argparse.ArgumentParser(
        description="Predict with hierarchical classifier",
    )
    parser.add_argument(
        "--query",
        type=str,
        required=True,
        help="Input FASTA file with query sequence(s) to make predictions",
    )
    parser.add_argument(
        "--classifier",
        type=str,
        required=True,
        help="Path to trained hierarchical classifier",
    )
    parser.add_argument(
        "--kmer",
        type=int,
        required=False,
        default=6,
        help="K-mer size for feature extraction [default: 6]",
    )
    parser.add_argument(
        "--predictions",
        type=str,
        required=True,
        help="Path to store predictions",
    )
    return parser.parse_args(args)


if __name__ == "__main__":  # pragma: no cover
    args = parse_args(sys.argv[1:])
    training_sequences, y_train = load_reference(args.reference)
    hierarchical_classifier = fit(training_sequences, y_train, args.kmer, args.cpus)
    pickle.dump(hierarchical_classifier, open(args.classifier, "wb"))
